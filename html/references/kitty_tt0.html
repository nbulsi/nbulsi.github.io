<!DOCTYPE html><html><head>
        <title>Kitty_ProjectionAndMask</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet"
            href="./resources/style/katex.min.css">
        <style>
    code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

    </style>
        <!-- The content below will be included at the end of the <head> element. --><script
            type="text/javascript">
document.addEventListener("DOMContentLoaded", function () {
  // your code here
});
</script></head><body for="html-export">

        <div class="crossnote markdown-preview  ">

            <h1
                id="kitty理解真值表projection-mask--endianness">Kitty：理解真值表——Projection,
                mask &amp; endianness </h1>
            <blockquote>
                <p>A trick is a clever idea that can be used once, while a
                    technique is a trick that can be used at least twice.<br>
                    -Donald E. Knuth</p>
            </blockquote>
            <p>无论是在ABC还是mockturtle中，对于bit manipulation经常会给读者造成困扰，这里就一些常用的bit
                level的technique以及其应用技巧做简述。这个文档<strong>不是</strong>一个Kitty
                manual的中文翻译，这样没有任何意义，这个文档从接口的角度阐明一些接口背后设计的原理以辅助读者对Kitty更加精准的使用。</p>
            <h2
                id="projection和mask以及bit-level-manipulation">projection和mask以及bit
                level manipulation </h2>
            <p>projection和mask的概念也不是Kitty中独有，早在ABC中就有比特级别的处理方式，虽然导致代码可读性降低，但是在空间使用率和速度上有着明显的优势。</p>
            <h3 id="关于elementary-variable和function">关于elementary
                variable和function </h3>
            <p>在介绍这两个概念之前，首先要了解单一变量和函数的表示，通常情况下我们说到真值表的时候，喜欢习惯性地“枚举”所有可能出现的情况，但是我们要明确在<strong>布尔函数</strong>这个context下我们枚举的具体是什么。<br>
                <br>我们课堂上了解过对于一个<span class="katex"><span
                        class="katex-mathml"><math
                            xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation
                                    encoding="application/x-tex">n</annotation></semantics></math></span><span
                        class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut"
                                style="height:0.4306em;"></span><span
                                class="mord mathnormal">n</span></span></span></span>输入的函数，我们有<span
                    class="katex"><span class="katex-mathml"><math
                            xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation
                                    encoding="application/x-tex">2^n</annotation></semantics></math></span><span
                        class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut"
                                style="height:0.6644em;"></span><span
                                class="mord"><span class="mord">2</span><span
                                    class="msupsub"><span class="vlist-t"><span
                                            class="vlist-r"><span class="vlist"
                                                style="height:0.6644em;"><span
                                                    style="top:-3.063em;margin-right:0.05em;"><span
                                                        class="pstrut"
                                                        style="height:2.7em;"></span><span
                                                        class="sizing reset-size6 size3 mtight"><span
                                                            class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>种赋值的可能性，在每种赋值的可能性下，又会存在2种不同的函数返回值（0/1），所以当我们提到一个<code>complete
                    boolean function</code>的时候，一共就会出现<span class="katex"><span
                        class="katex-mathml"><math
                            xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><msup><mn>2</mn><mi>n</mi></msup></msup></mrow><annotation
                                    encoding="application/x-tex">2^{2^n}</annotation></semantics></math></span><span
                        class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut"
                                style="height:0.88em;"></span><span
                                class="mord"><span class="mord">2</span><span
                                    class="msupsub"><span class="vlist-t"><span
                                            class="vlist-r"><span class="vlist"
                                                style="height:0.88em;"><span
                                                    style="top:-3.063em;margin-right:0.05em;"><span
                                                        class="pstrut"
                                                        style="height:2.7em;"></span><span
                                                        class="sizing reset-size6 size3 mtight"><span
                                                            class="mord mtight"><span
                                                                class="mord mtight"><span
                                                                    class="mord mtight">2</span><span
                                                                    class="msupsub"><span
                                                                        class="vlist-t"><span
                                                                            class="vlist-r"><span
                                                                                class="vlist"
                                                                                style="height:0.7385em;"><span
                                                                                    style="top:-2.931em;margin-right:0.0714em;"><span
                                                                                        class="pstrut"
                                                                                        style="height:2.5em;"></span><span
                                                                                        class="sizing reset-size3 size1 mtight"><span
                                                                                            class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>种函数。<br>
                <br>所以对于一个2输入的逻辑结构，有4种组合，有16种可以表示的函数。</p>
            <p>Context的概念在这里很重要，就是在有多少变量的context下我需要这样长度的表示形式？为什么对于一个<span
                    class="katex"><span class="katex-mathml"><math
                            xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>=</mo><mi>x</mi></mrow><annotation
                                    encoding="application/x-tex">f =
                                    x</annotation></semantics></math></span><span
                        class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut"
                                style="height:0.8889em;vertical-align:-0.1944em;"></span><span
                                class="mord mathnormal"
                                style="margin-right:0.10764em;">f</span><span
                                class="mspace"
                                style="margin-right:0.2778em;"></span><span
                                class="mrel">=</span><span class="mspace"
                                style="margin-right:0.2778em;"></span></span><span
                            class="base"><span class="strut"
                                style="height:0.4306em;"></span><span
                                class="mord mathnormal">x</span></span></span></span>的表示，在仅有变量<span
                    class="katex"><span class="katex-mathml"><math
                            xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo
                                        separator="true">,</mo><mi>y</mi></mrow><annotation
                                    encoding="application/x-tex">{x,
                                    y}</annotation></semantics></math></span><span
                        class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut"
                                style="height:0.625em;vertical-align:-0.1944em;"></span><span
                                class="mord"><span
                                    class="mord mathnormal">x</span><span
                                    class="mpunct">,</span><span class="mspace"
                                    style="margin-right:0.1667em;"></span><span
                                    class="mord mathnormal"
                                    style="margin-right:0.03588em;">y</span></span></span></span></span>的context下和仅有变量<span
                    class="katex"><span class="katex-mathml"><math
                            xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo
                                        separator="true">,</mo><mi>y</mi><mo
                                        separator="true">,</mo><mi>z</mi></mrow><annotation
                                    encoding="application/x-tex">{x, y
                                    ,z}</annotation></semantics></math></span><span
                        class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut"
                                style="height:0.625em;vertical-align:-0.1944em;"></span><span
                                class="mord"><span
                                    class="mord mathnormal">x</span><span
                                    class="mpunct">,</span><span class="mspace"
                                    style="margin-right:0.1667em;"></span><span
                                    class="mord mathnormal"
                                    style="margin-right:0.03588em;">y</span><span
                                    class="mpunct">,</span><span class="mspace"
                                    style="margin-right:0.1667em;"></span><span
                                    class="mord mathnormal"
                                    style="margin-right:0.04398em;">z</span></span></span></span></span>的context下<strong>表示不同</strong>，这里需要明确清楚。</p>
            <h3 id="projection">projection </h3>
            <p>projection这里kitty使用<code>uint64_t</code>的类型，也就是64bit的unsigned
                int，这里最多处理6输入的complete boolean
                function，请注意，根据前面一节的内容，这个<code>uint64_t</code>中包含的是<strong>所有的变量组合对应的结果的集合</strong>，也就是TT中<strong>值</strong>的那一列。<br>
                <br>这里的每一行都可以用来做bit级别的取样，同样的，整体上看，它们就是6输入的complete boolean
                function的elementary variable的表示。</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-constexpr">constexpr</span> <span class="token keyword keyword-uint64_t">uint64_t</span> projections<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0xaaaaaaaaaaaaaaaa</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0xcccccccccccccccc</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0xf0f0f0f0f0f0f0f0</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0xff00ff00ff00ff00</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0xffff0000ffff0000</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0xffffffff00000000</span> <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>我们先把它展开，以第一个</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0xaaaaaaaaaaaaaaaa</span> <span class="token punctuation">)</span>
</code></pre><p>为例：</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span> <span class="token number">1010</span>
</code></pre><p>以此类推。这样就和上一节的内容完全对应上了。<br>
                <br>另外，对于：</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-constexpr">constexpr</span> <span class="token keyword keyword-uint64_t">uint64_t</span> projections_neg<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0x5555555555555555</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0x3333333333333333</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0x0f0f0f0f0f0f0f0f</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0x00ff00ff00ff00ff</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0x0000ffff0000ffff</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0x00000000ffffffff</span> <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>其实我们对比<code>projections</code>和<code>projections_neg</code>就能够发现，相同index下这里的每一个比特的数字都是互补的，所以上下两者取到的是互补的bit位:<br>
                以</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">UINT64_C</span><span class="token punctuation">(</span> <span class="token number">0x5555555555555555</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre><p>为例：</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span> <span class="token number">0101</span>
</code></pre><p>与上述<code>projection</code>例子形成反转对比。</p>
            <h3 id="mask">mask </h3>
            <p>以Kitty中的<code>create_nth_var5</code> test为例：</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> mask <span class="token operator">=</span> <span class="token number">0xffffffff</span><span class="token punctuation">;</span>
</code></pre><p>和</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span> tt_s<span class="token punctuation">.</span>_bits<span class="token punctuation">,</span> detail<span class="token double-colon punctuation">::</span>projections<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> mask <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>的指定，会使得结果为一个有效位数只有后32bit的unsigned
                int，后续的计算只保留了5个variable所对应的范围，而非6个。注意这里利用了“projection”，实际上也是利用真值表来表示了elementary
                variable，实际上projection的应用范围要比它表示elementary
                variable要广很多，这里只是它的一个巧用的场景罢了。请时刻谨记，projection，字如其名，就是保留1的bit位置，抹去0的bit位置的信息，在不同的场景下有不同的功能。</p>
            <p><br>还有一个比较容易看到的mask的应用场景，就是计算一个unsigned
                int的二进制表示中1的数量，Kitty中有很多的使用场景，这里以<code>count_ones</code>为例：</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token keyword keyword-template">template</span><span class="token operator">&lt;</span><span class="token keyword keyword-uint32_t">uint32_t</span> NumVars<span class="token operator">&gt;</span>
<span class="token keyword keyword-inline">inline</span> <span class="token keyword keyword-uint64_t">uint64_t</span> <span class="token function">count_ones</span><span class="token punctuation">(</span> <span class="token keyword keyword-const">const</span> static_truth_table<span class="token operator">&lt;</span>NumVars<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> tt <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-return">return</span> <span class="token function">__builtin_popcount</span><span class="token punctuation">(</span> tt<span class="token punctuation">.</span>_bits <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">__builtin_popcount</span><span class="token punctuation">(</span> tt<span class="token punctuation">.</span>_bits <span class="token operator">&gt;&gt;</span> <span class="token number">32</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>这里<code>__builtin_popcount</code>的参数是个32位的<code>unsigned
                    int</code>，而在这个<code>static_truth_table</code>中的<code>bits</code>是64位，所以一开始利用32位的全1的mask做bit
                level的与操作，只取后面32位，构成一个新的<code>unsigned int</code>，而后向右shift
                32位形成一个新的32bit的unsigned int，计算原来64
                bit的左半部分的1的数量，相加得到总共的数量。可以牢记这个<code>__builtin_popcount</code>库函数的使用场景，如果自己构建bit
                level manipulation的算法可以直接拿来使用。</p>
            <h3 id="big-endian--small-endian">Big-endian &amp;&amp; small-endian
            </h3>
            <p>关于如何存放所需要的bit，<em>The Art of
                    Programming</em>书中给出了比较精简的定义，就是第一个元素（first
                item(Byte)）是放在最大的位置还是最小的位置，如果放在最大的位置，就是Big-endian，如果放在最小的位置就是Small-endian。<br>
                <br>我们上述对elementary
                variable的表示明显是Big-endian，使用Big-endian也会使数据其在数学表示上更加直观易懂，与“进制”数的表示和计算更加贴合。<br>
                <br>在罗列真值表的过程中，我们通常是从小到达进行罗列，自上而下罗列，所对应的函数的表示如果使用Big-endian的话需要从下往上，从左到右依次写在纸上，也就是第一个写出来的most
                significant byte。<br>
                <br>上面的描述如果让你觉得抽象，那么我们以一个Kitty中<code>constructors.cpp</code>的例子来看：</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">TEST</span><span class="token punctuation">(</span> ConstructorsTest<span class="token punctuation">,</span> create_nth_var5 <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
static_truth_table<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;</span> tt_s<span class="token punctuation">;</span>
dynamic_truth_table <span class="token function">tt_d</span><span class="token punctuation">(</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> mask <span class="token operator">=</span> <span class="token number">0xffffffff</span><span class="token punctuation">;</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span> <span class="token keyword keyword-auto">auto</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token function">create_nth_var</span><span class="token punctuation">(</span> tt_s<span class="token punctuation">,</span> i <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span> tt_s<span class="token punctuation">.</span>_bits<span class="token punctuation">,</span> detail<span class="token double-colon punctuation">::</span>projections<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> mask <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">create_nth_var</span><span class="token punctuation">(</span> tt_d<span class="token punctuation">,</span> i <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span> tt_s<span class="token punctuation">.</span>_bits<span class="token punctuation">,</span> tt_d<span class="token punctuation">.</span>_bits<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>我们可以看到实际上此处利用了上面的<code>projection</code>来作为elementary
                varible的对比项，此处之前"关于elementary variable和function"部分也描述过，这里所有的1靠近左侧，所有的0靠近右侧，实际上在字面上就是一个Big-endian的表达形式。<br>
                <br>这里还有一个比较明显的例子，大家可以参考</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">TEST_F</span><span class="token punctuation">(</span> BitOperationsTest<span class="token punctuation">,</span> find_first_bit <span class="token punctuation">)</span>
</code></pre><p>和</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">TEST_F</span><span class="token punctuation">(</span> BitOperationsTest<span class="token punctuation">,</span> find_last_bit <span class="token punctuation">)</span>
</code></pre><p>这里的两个函数分别是找到最小的1的bit所在的index和最大的1的bit所在的index我们结合之前elementary
                variable的例子可以看到：</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span> <span class="token function">find_first_one_bit</span><span class="token punctuation">(</span> <span class="token generic-function"><span class="token function">nth</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">6</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>是<code>1010...1010</code>的从右至左的第一个1的index是1，而</p>
            <pre data-role="codeBlock" data-info="C++"
                class="language-cpp C++"><code><span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span> <span class="token function">find_last_one_bit</span><span class="token punctuation">(</span> <span class="token generic-function"><span class="token function">nth</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">6</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">63</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>是<code>1010...1010</code>的从左至右的第一个1的index是63。<br>
                这里还需要注意的是，我们在<strong>字面byte
                    level的index和数字bit的index上是不同的</strong>，通常情况下我们看到的写在纸上的，称最左侧的为最小的index，而在上述的例子中，显然在讨论bit
                level的时候是完全相反的，最左侧的是最大的index而最右侧的是最小的index，所以接口的名称为<code>find_first_one_bit</code>或者<code>find_last_one_bit</code>的时候是bit
                level的index。<br>
                <br>请不要小瞧这个简单的函数（接口），在日后的学习中，好比NPN equivalence
                class中每一项的representative function都是由该class的最小truth
                table的index来标注的，将来会有更多有趣的场景。</p>

        </div>

    </body></html>